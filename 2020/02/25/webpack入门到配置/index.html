
<!DOCTYPE html>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#202020">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
  
  
    <meta name="keywords" content="李博 个人博客 前端博客">
  

  
    <meta name="description" content="李博的个人前端博客，主要分享一些前端文章和生活。">
  
  
  <link rel="icon" type="image/x-icon" href="/images/logo.png">
  <title>写给自己看的webpack入门配置 [ 李博blog ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
    
      <link rel="stylesheet" href="/css/xoxo.css">
    
  
  <!-- <link rel="stylesheet" text="text/css" href="/js/prism.css"> -->
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"><script src="/js/prism.js"></script></head>


<body>
  <div class="nav-container">
    <nav class="home-menu pure-menu pure-menu-horizontal">
  <a class="pure-menu-heading" href="/">
    <img class="avatar" src="https://www.itlb.cn/images/logo.png">
    <span class="title">李博blog</span>
  </a>

  <ul class="pure-menu-list clearfix">
      
          
            <li class="pure-menu-item"><a href="/" class="pure-menu-link">首页</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/archives" class="pure-menu-link">归档</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/tags" class="pure-menu-link">标签</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/search" class="pure-menu-link">搜索</a></li>
          
      
          
            <li class="pure-menu-item"><a href="https://www.itlb.cn" class="pure-menu-link">关于</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/atom.xml" class="pure-menu-link">订阅</a></li>
          
      
  </ul>
   
</nav>
  </div>

  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
      <div class="post-container">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        写给自己看的webpack入门配置
      </h1>
      <span>
        
        <time class="time" datetime="2020-02-25T14:20:53.000Z">
        2020-02-25
      </time>
        
      </span>
      <span class="slash">/</span>
      <span class="post-meta">
      <span class="post-tags">
        
      </span>
    </span>
      <span class="slash">/</span>
      <span class="read">
      <span id="busuanzi_value_page_pv"></span> 点击
    </span>
      <span class="slash">/</span>
      <span class="read">阅读耗时 13 分钟</span>
    </header>

    <div class="post-content">
      <p>如果想要成为一名优秀的前端开发人员，除了对基础编程语言的掌握以外。项目工程化也是需要了解和掌握的，目前大部分开发人员使用webpack作为项目构建工具。而我对于webpack的了解不是很多。正好趁这段时间学习一下webpack的基础及配置。</p>
<a id="more"></a>

<h3 id="webpack核心概念"><a href="#webpack核心概念" class="headerlink" title="webpack核心概念"></a>webpack核心概念</h3><p>webpack作为一个现代 JavaScript 应用程序的静态模块打包器有以下几个核心概念：</p>
<ul>
<li><strong>入口(entry)</strong></li>
<li><strong>输出(output)</strong></li>
<li><strong>loader</strong></li>
<li><strong>插件(plugins)</strong></li>
</ul>
<h3 id="入口-entry"><a href="#入口-entry" class="headerlink" title="入口(entry)"></a>入口(entry)</h3><p>入口（entry）一般是webpack指定哪个模块（文件）作为构建内部依赖的开始。从入口文件开始，webpack会找出哪些模块和库是入口文件依赖的，每个依赖被处理最后将输出到 bundles 的文件中。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// webpack.config.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token string">'./path/to/my/entry/file.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="出口-output"><a href="#出口-output" class="headerlink" title="出口(output)"></a>出口(output)</h3><p>出口（output）是作为webpack通过编译输出的目录名称，主要是用来接收处理后文件保存的位置，默认值为’./dist’。</p>
<pre class=" language-javascript"><code class="language-javascript">
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./path/to/my/entry/file.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token punctuation">:</span> <span class="token string">'my-first-webpack.bundle.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h3><p>loader 让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块。</p>
<pre class=" language-javascript"><code class="language-javascript">
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'my-first-webpack.bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token punctuation">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> <span class="token string">'raw-loader'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>以上配置对一个module定义了rules属性，里面包含两个必须属性：test和use。这相当于告诉webpack：</p>
<blockquote>
<p>“嘿，webpack 编译器，当你碰到「在 require()/import 语句中被解析为 ‘.txt’ 的路径」时，在你对它打包之前，先使用 raw-loader 转换一下。”</p>
</blockquote>
<h3 id="插件（plugin）"><a href="#插件（plugin）" class="headerlink" title="插件（plugin）"></a>插件（plugin）</h3><p>上面讲到loader被用于转换某些类型的模块（如转换.vue、.jpeg、.jsx）等。而插件（plugin）可以处理更广的任务，从打包优化和压缩，一直到重新定义环境中的变量。</p>
<p>插件使用的方法一般是通过require引入，然后将其添加到plugin数组中。</p>
<pre class=" language-javascript"><code class="language-javascript">
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 通过 npm 安装</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 用于访问内置插件</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token punctuation">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> <span class="token string">'raw-loader'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>template<span class="token punctuation">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="从0开始我们的配置"><a href="#从0开始我们的配置" class="headerlink" title="从0开始我们的配置"></a>从0开始我们的配置</h3><h4 id="1-1-初始化项目"><a href="#1-1-初始化项目" class="headerlink" title="1.1 初始化项目"></a>1.1 初始化项目</h4><p>新建一个目录，初始化npm</p>
<pre><code>    npm i</code></pre><p>安装webpack包</p>
<pre><code>    npm i -D webpack webpack-cli</code></pre><p>新建一个 src 文件，然后创建一个main.js，然后写点测试代码</p>
<pre><code>   console.log(&#39;hello world&#39;);</code></pre><p>配置package.json命令</p>
<pre class=" language-javascript"><code class="language-javascript">
  <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"build"</span><span class="token punctuation">:</span><span class="token string">"webpack src/main.js"</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>如果生成了dist目录，就说明内部含有main.js文件打包成功了</p>
<h4 id="1-2-开始自己的配置"><a href="#1-2-开始自己的配置" class="headerlink" title="1.2 开始自己的配置"></a>1.2 开始自己的配置</h4><p>以上只是webpack默认配置，如果想要实现更灵活丰富的配置还需要自己动手进行自定义配置。首先新建build文件夹，里面新建一个webpack.config.js文件。</p>
<pre class=" language-javascript"><code class="language-javascript">
<span class="token comment" spellcheck="true">//webpack.config.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span><span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 开发模式</span>
    entry<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../src/main.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 入口文件</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'output.js'</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// 打包后的文件名称</span>
        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dist'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 打包后的目录</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>然后更改下打包命令</p>
<pre class=" language-javascript"><code class="language-javascript">
 <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"build"</span><span class="token punctuation">:</span><span class="token string">"webpack --config build/webpack.config.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
<p>执行 npm run build 就在dist目录下生成了 output.js 文件，这个文件就是我们需要在浏览器中实际运行的文件。</p>
<h4 id="1-3配置HTML模板"><a href="#1-3配置HTML模板" class="headerlink" title="1.3配置HTML模板"></a>1.3配置HTML模板</h4><p>以上JS打包好后，需要引入到HTML文件中，但是不可能每次都要手动引入。且为了考虑服务器缓存优化，每次更新后的js文件名称需要动态改变。基于这两点，我们开始自定义配置：</p>
<p>为了服务器缓存，首先改变每次输出js文件名称</p>
<pre class=" language-javascript"><code class="language-javascript">
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].[hash:8].js'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//打包后生产唯一8位的hash值</span>
        path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dist'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//打包后的目录</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
</code></pre>
<p>接下来新建一个public文件夹，里面新建index.html文件，然后需要借助一个插件：</p>
<pre><code>  npm i -D html-webpack-plugin
</code></pre><pre class=" language-javascript"><code class="language-javascript">
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/main.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//入口文件</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].[hash:8].js'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//打包后的文件名称</span>
        path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dist'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//打包后的文件夹</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span>
            <span class="token punctuation">{</span>
                template<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../public/index.html'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//HTML模板文件</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
</code></pre>
<p>此时执行 npm run build 会发现 dist 目录下会出现index.html，并且html文件动态引入最新生成的js文件。</p>
<p><img src="https://libo-blog-static.oss-cn-beijing.aliyuncs.com/images/webpack01.png?Expires=1582944282&OSSAccessKeyId=TMP.hiwR6d8UCPNjY77npSJf3hAANnXtRFaTYtvYp5XCiMsFHudGq5FkP6PRXH7E6snwoRa6tCjMXKnQTxPxgvXis27xspzyD5JoY5rPZYkHXxFC9JZEUQaBj36D1tXaGn.tmp&Signature=OssldLK92lCMQjgiWb4iy%2BBO4rE%3D" alt></p>
<h5 id="1-3-1-clean-webpack-plugin"><a href="#1-3-1-clean-webpack-plugin" class="headerlink" title="1.3.1 clean-webpack-plugin"></a>1.3.1 clean-webpack-plugin</h5><blockquote>
<p>由于我们每次执行npm run build 会发现dist文件夹里会残留上次打包的文件，这里推荐一个plugin来帮我们在打包输出前清空文件夹clean-webpack-plugin</p>
</blockquote>
<pre class=" language-javascript"><code class="language-javascript">
<span class="token keyword">const</span> <span class="token punctuation">{</span>CleanWebpackPlugin<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...省略其他配置</span>
    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="1-4引用CSS"><a href="#1-4引用CSS" class="headerlink" title="1.4引用CSS"></a>1.4引用CSS</h4><p>首先在我们的入口文件 main.js 中引入css文件，引入css文件后需要配置css-loader来解析</p>
<pre class=" language-javascript"><code class="language-javascript">
<span class="token comment" spellcheck="true">//main.js</span>
<span class="token keyword">import</span> <span class="token string">'./assets/index.css'</span>
<span class="token keyword">import</span> <span class="token string">'./assets/test.css'</span>
</code></pre>
<pre><code>
  npm i -D style-loader css-loader
</code></pre><p>如果是less来构建则多需要安装两个loader</p>
<pre><code>
  npm i -D less less-loader
</code></pre><p>配置文件如下：</p>
<pre class=" language-javascript"><code class="language-javascript">
<span class="token comment" spellcheck="true">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...省略其他配置</span>
    module<span class="token punctuation">:</span><span class="token punctuation">{</span>
      rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token punctuation">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
          use<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// 从右向左解析原则</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          test<span class="token punctuation">:</span><span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
          use<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">,</span><span class="token string">'less-loader'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// 从右向左解析原则</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<p>执行命令后会重新打包，打开HTML后会发现css已经起作用了，但是打开控制台发现样式是嵌入式。</p>
<p><img src="https://libo-blog-static.oss-cn-beijing.aliyuncs.com/images/webpack2.png" alt></p>
<p>为了解决以上问题，我们可以使用官方推荐的 ExtractTextWebpackPlugin 插件来解决这个问题</p>
<pre class=" language-javascript"><code class="language-javascript">
<span class="token keyword">const</span> ExtractTextWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'extract-text-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/main.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].[hash:8].js'</span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span>
            <span class="token punctuation">{</span>
                template<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../public/index.html'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">ExtractTextWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token punctuation">:</span><span class="token string">'css/[name][hash:8].css'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token punctuation">:</span> ExtractTextWebpackPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="1-5加载图片等媒体文件"><a href="#1-5加载图片等媒体文件" class="headerlink" title="1.5加载图片等媒体文件"></a>1.5加载图片等媒体文件</h4><p> <strong><em>file-loader</em></strong> 和 <strong><em>url-loader</em></strong> 可以接收并加载任何文件，然后将其输出到构建目录。<strong><em>url-loader</em></strong> 一般与 <strong><em>file-loader</em></strong> 搭配使用，功能与 file-loader 类似，不过 url-loader 可以配置存储文件上限，如果超出配置的大小则会返回base编码。</p>
<pre class=" language-javascript"><code class="language-javascript">
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//...省略其他配置</span>
   <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(jpe?g|png|gif)$/i</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//T图片文件</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                limit<span class="token punctuation">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
                fallback<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                        name<span class="token punctuation">:</span> <span class="token string">'[name].[hash:8].[ext]'</span><span class="token punctuation">,</span>
                        outputPath<span class="token punctuation">:</span> <span class="token string">'images/'</span> <span class="token comment" spellcheck="true">//打包后的文件目录</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(mp4|webm|ogg|mp3|wav|flac|aac)(\?.*)?$/</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//媒体文件</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                limit<span class="token punctuation">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
                fallback<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                        name<span class="token punctuation">:</span> <span class="token string">'[name].[hash:8].[ext]'</span><span class="token punctuation">,</span>
                        outputPath<span class="token punctuation">:</span> <span class="token string">'media/'</span> <span class="token comment" spellcheck="true">//打包后的文件目录</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="1-6css引入图片资源导致的Bug"><a href="#1-6css引入图片资源导致的Bug" class="headerlink" title="1.6css引入图片资源导致的Bug"></a>1.6css引入图片资源导致的Bug</h4><p>在我按照以上配置完成执行 npm run build 成功执行编译，但是执行打包后的HTML文件却不能正常显示背景图片，具体原因通过查看编译后的文件发现，造成bug的原因是css背景图片路径出现了问题。</p>
<p><img src="https://libo-blog-static.oss-cn-beijing.aliyuncs.com/images/webpack4.png" alt></p>
<p>webpack在打包后，css引入的资源路径是按照绝对路径引入的。这就当前css文件夹下的css文件引入资源失效。</p>
<p>解决css引入资源失效问题也非常好解决，就是在 css-loader 配置里面添加一个配置项：</p>
<pre class=" language-javascript"><code class="language-javascript">
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//...省略其他配置</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
          use<span class="token punctuation">:</span> ExtractTextWebpackPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              publicPath<span class="token punctuation">:</span> <span class="token string">'../'</span>  <span class="token comment" spellcheck="true">//publicPath会输出解析文件目录</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="1-7用babel转义js文件"><a href="#1-7用babel转义js文件" class="headerlink" title="1.7用babel转义js文件"></a>1.7用babel转义js文件</h4><p>首先安装babel-loader</p>
<pre><code>
  npm i -D babel-loader @babel/preset-env @babel/core
</code></pre><p>具体配置如下</p>
<pre class=" language-javascript"><code class="language-javascript">
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//...省略其他配置</span>

  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
     <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

    </div>

    <div>全文完。</div>
  </article>
  <div class="toc-container">
    
  <div id="toc" class="toc-article">
    <strong class="toc-title">目录</strong>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack核心概念"><span class="toc-text">webpack核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#入口-entry"><span class="toc-text">入口(entry)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#出口-output"><span class="toc-text">出口(output)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loader"><span class="toc-text">loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插件（plugin）"><span class="toc-text">插件（plugin）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#从0开始我们的配置"><span class="toc-text">从0开始我们的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-初始化项目"><span class="toc-text">1.1 初始化项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-开始自己的配置"><span class="toc-text">1.2 开始自己的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3配置HTML模板"><span class="toc-text">1.3配置HTML模板</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-1-clean-webpack-plugin"><span class="toc-text">1.3.1 clean-webpack-plugin</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4引用CSS"><span class="toc-text">1.4引用CSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5加载图片等媒体文件"><span class="toc-text">1.5加载图片等媒体文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6css引入图片资源导致的Bug"><span class="toc-text">1.6css引入图片资源导致的Bug</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7用babel转义js文件"><span class="toc-text">1.7用babel转义js文件</span></a></li></ol></li></ol>
  </div>


  </div>
</div>
<div class="copyright">
    <span>本作品采用</span>
    <a href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a>
    <span>进行许可。 转载时请注明原文链接。</span>
</div>
<div class="share" style="width: 100%;">
  <!-- <img src="https://kevinofneu-blog-static.oss-cn-beijing.aliyuncs.com/static/2018-12-10-qrcode_for_gh_ffacf5722095_258.jpg" alt="Running Geek" style="margin: auto; display: block;"/>

  <div style="margin: auto; text-align: center; font-size: 0.8em; color: grey;">老铁们关注走一走，不迷路</div>
   -->
</div>

  
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>〈 </span>
          <a href="/2020/02/15/React-hooks-学习总结/" rel="next" title="React hooks 学习总结">
          React hooks 学习总结
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
          
      </div>
    </div>
  


    </div>

    

  </div>
  <footer class="footer text-center">
    <div id="bottom-inner">
        <a class="bottom-item" href="https://www.itlb.cn">首页</a> |
        <a class="bottom-item" href="https://www.itlb.cn" target="_blank">主站</a> |
        <a class="bottom-item" href="https://github.com/KevinOfNeu" target="_blank">GitHub</a> |
        <a class="bottom-item" href="https://hexo.io" target="_blank">Powered by hexo</a> |
        <a class="bottom-item" href="https://github.com/KevinOfNeu/hexo-theme-xoxo" target="_blank">Theme xoxo</a>
    </div>
</footer>
  

<script>
  (function(window, document, undefined) {

    var timer = null;

    function returnTop() {
      cancelAnimationFrame(timer);
      timer = requestAnimationFrame(function fn() {
        var oTop = document.body.scrollTop || document.documentElement.scrollTop;
        if (oTop > 0) {
          document.body.scrollTop = document.documentElement.scrollTop = oTop - 50;
          timer = requestAnimationFrame(fn);
        } else {
          cancelAnimationFrame(timer);
        }
      });
    }

    var hearts = [];
    window.requestAnimationFrame = (function() {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          setTimeout(callback, 1000 / 60);
        }
    })();
    init();

    function init() {
      css(".heart{z-index:9999;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
      attachEvent();
      gameloop();
      addMenuEvent();
    }

    function gameloop() {
      for (var i = 0; i < hearts.length; i++) {
        if (hearts[i].alpha <= 0) {
          document.body.removeChild(hearts[i].el);
          hearts.splice(i, 1);
          continue;
        }
        hearts[i].y--;
        hearts[i].scale += 0.004;
        hearts[i].alpha -= 0.013;
        hearts[i].el.style.cssText = "left:" + hearts[i].x + "px;top:" + hearts[i].y + "px;opacity:" + hearts[i].alpha + ";transform:scale(" + hearts[i].scale + "," + hearts[i].scale + ") rotate(45deg);background:" + hearts[i].color;
      }
      requestAnimationFrame(gameloop);
    }

    /**
     * 给logo设置点击事件
     * 
     * - 回到顶部
     * - 出现爱心
     */
    function attachEvent() {
      var old = typeof window.onclick === "function" && window.onclick;
      var logo = document.getElementById("logo");
      if (logo) {
        logo.onclick = function(event) {
          returnTop();
          old && old();
          createHeart(event);
        }
      }
      
    }

    function createHeart(event) {
      var d = document.createElement("div");
      d.className = "heart";
      hearts.push({
        el: d,
        x: event.clientX - 5,
        y: event.clientY - 5,
        scale: 1,
        alpha: 1,
        color: randomColor()
      });
      document.body.appendChild(d);
    }

    function css(css) {
      var style = document.createElement("style");
      style.type = "text/css";
      try {
        style.appendChild(document.createTextNode(css));
      } catch (ex) {
        style.styleSheet.cssText = css;
      }
      document.getElementsByTagName('head')[0].appendChild(style);
    }

    function randomColor() {
      // return "rgb(" + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + ")";
      return "#F44336";
    }

    function addMenuEvent() {
      var menu = document.getElementById('menu-main-post');
      if (menu) {
        var toc = document.getElementById('toc');
        if (toc) {
          menu.onclick = function() {
            if (toc) {
              if (toc.style.display == 'block') {
                toc.style.display = 'none';
              } else {
                toc.style.display = 'block';
              }
            }
          };
        } else {
          menu.style.display = 'none';
        }
      }
    }

  })(window, document);
</script>

  



</body>
</html>
